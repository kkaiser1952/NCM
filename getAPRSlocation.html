<!DOCTYPE html>
<html>
  <head>
    <title>APRS API Test</title>
    
    <link rel="shortcut icon" href="#" />

    <meta charset = "UTF-8" />
  </head>
  <body>
    <h1>APRS API Test</h1>
    <label for="callsign">Callsign:</label>
    <input type="text" id="callsign" name="callsign" />
    <button onclick="getAPRSData()">Get Location</button>
    <div id="location"></div>
    
    <script>
      function getAPRSData() {
        var callsign = document.getElementById("callsign").value.toUpperCase();
        var apiKey = "5275.AYRjLwAFgx6ud"; // My aprs.fi API key
        //var url = `https://api.aprs.fi/api/get?name=${callsign}&what=loc&apikey=${apiKey}&format=json`;
        var url = `https://api.aprs.fi/api/get?name=${callsign}&what=loc&apikey=${apiKey}&format=jsonp&callback=aprsCallback`;
        
        console.log('@24 '+url);
          
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = url;
        document.getElementsByTagName('head')[0].appendChild(script);
        
        window.aprsCallback = function(data) {
          if (data.result === "get") {
            var location = data.entries[0].lat + ", " + data.entries[0].lng;
            document.getElementById("location").innerHTML = location;
            console.log('@35 '+JSON.stringify(data)); // log the full response data to the console
          } else {
            throw new Error(data.description);
          }
        };
      }
    </script>
  </body>
</html>
